


物理机监控信息接口
==========================

.. toctree::
   :maxdepth: 2
   :numbered:



概要
--------------------------

获取物理机的监控信息，第一个直接返回 HTML，第二个返回指定监控项的 json 数据，HTML 页面中
已默认处理好这个 json，无需 Token。


API规范
--------------------------

获取物理机监控信息API入口与API列表如下：


    * API入口: http://m.scloudm.com/
    * API列表:

+---------------------------------------------------------+-------------------------------+------------+
|  资源                                                   |  操作                         |  HTTP方法  |
+=========================================================+===============================+============+
|  /pm_monitor/<system_snid>/                             |  直接返回 HTML                |  GET       |
+---------------------------------------------------------+-------------------------------+------------+
| /pm_monitor/statics/<metric>/<system_snid>/<duration>/  |  返回指定参数的 json 结果     |  GET       |
+---------------------------------------------------------+-------------------------------+------------+

查看指定机器的监控页面
---------------------------------------


+------------+---------------------------+-----------------+
|  HTTP方法  |  URI路径                  |  描述           |
+============+===========================+=================+
|  GET       |  /mana_api/<system_snid>/ |  监控图         |
+------------+---------------------------+-----------------+

请求参数

+-----------------------+----------+--------------------------+
|  字段名               |  类型    |  描述                    |
+=======================+==========+==========================+
|  system_snid          |  string  |  物理机系统序列号        |
+-----------------------+----------+--------------------------+


请求样例

此为特殊情况，打开浏览器，访问 http://m.scloudm.com/mana_api/<system_snid>/


获取物理机监控明细信息
--------------------------------------


+------------+---------------------------------------------------------+------------------------+
|  HTTP方法  |  URI路径                                                |  描述                  |
+============+=========================================================+========================+
|  POST      |  /pm_monitor/statics/<metric>/<system_snid>/<duration>/ |  指定参数获取监控信息  |
+------------+---------------------------------------------------------+------------------------+

请求参数

+----------------+----------+----------------------------------------------------------------------------+
|  字段名        |  类型    |  描述                                                                      |
+================+==========+============================================================================+
|  metric        |  string  |  监控项 [cpu_util|network_in|network_out|disk_write|disk_read]         |
+----------------+----------+----------------------------------------------------------------------------+
|  system_snid   |  string  |  物理机系统序列号                                                          |
+----------------+----------+----------------------------------------------------------------------------+
|  duration      |  string  |  查询时间范围 [3h|1d|7d|30d]                                              |
+----------------+----------+----------------------------------------------------------------------------+

请求样例

::


    curl  -i \
          -X POST 'http://m.scloudm.com/mana_api/pm_monitor/statics/cpu_util/123456789/7d/'


返回参数

+-------------------+-------------+-------------------------------------------------------------------------+
|  字段名           |  类型       |  描述                                                                   |
+===================+=============+=========================================================================+
|  data             |  list       |  包含了每个时间节点的监控信息数组                                       |
+-------------------+-------------+-------------------------------------------------------------------------+
|  name             |  string     |  物理机序列号或者网卡IP                                                 |
+-------------------+-------------+-------------------------------------------------------------------------+
|  period_start     |  string     |  开始时间                                                               |
+-------------------+-------------+-------------------------------------------------------------------------+
|  avg              |  float      |  平均值                                                                 |
+-------------------+-------------+-------------------------------------------------------------------------+
|  unit             |  string     |  单位                                                                   |
+-------------------+-------------+-------------------------------------------------------------------------+

返回样例

::


        HTTP/1.0 200 OK
        Content-Type: text/html; charset=utf-8
        Content-Length: 345
        Server: Werkzeug/0.10.4 Python/2.7.5
        Date: Thu, 28 Jan 2016 07:49:50 GMT

        [
            {"data":
                [
                    {"min": 10.5, "max": 10.5, "sum": 10.5, "period_start": "2016-01-28T10:30:00", "avg": 10.5, "unit": "%"},
                    {"min": 12.5, "max": 12.5, "sum": 12.5, "period_start": "2016-01-28T10:40:00", "avg": 12.5, "unit": "%"},
                    {"min": 30.5, "max": 30.5, "sum": 30.5, "period_start": "2016-01-28T10:50:00", "avg": 30.5, "unit": "%"}
                ],
              "name": "123"
            }
        ]

