


获取虚拟机列表
====================

.. toctree::
   :maxdepth: 2
   :numbered:



概要
--------------------

返回当前区域项目所有虚拟机列表, 需要先通过身份验证获取 Token, 再带上这个 Token 去获取虚拟机列表。


API规范
--------------------------

获取虚拟机API入口与API列表如下：


    * API入口: http://m.scloudm.com/
    * API列表:

+------------------+-------------------------------+------------+--------------------------------+
|  资源            |  操作                         |  HTTP方法  |  URI路径                       |
+==================+===============================+============+================================+
|  vm              |  获取所有虚拟机列表           |  GET       |  /mana_api/vm                  |
+------------------+-------------------------------+------------+--------------------------------+

先认证并获取新令牌(已可用), 使用该令牌执行获取动作
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

+------------+-------------------+-----------------+
|  HTTP方法  |  URI路径          |  描述           |
+============+===================+=================+
|  GET       |  /mana_api/vm     |  获取物理机列表 |
+------------+-------------------+-----------------+

请求参数

+-----------------------+----------+---------------+
|  字段名               |  类型    |  描述         |
+=======================+==========+===============+
|  tenant_id（必选）    |  string  |  租户id       |
+-----------------------+----------+---------------+
|  region（必选）       |  string  |  所属区域     |
+-----------------------+----------+---------------+
|  f（可选）            |  int     |  分页起始点   |
+-----------------------+----------+---------------+
|  t（可选）            |  int     |  分页结束点   |
+-----------------------+----------+---------------+

请求样例

::


    curl  -i \
          -H 'X-Auth-Token: {token_id}' \
          -X GET 'http://m.scloudm.com/mana_api/vm?tenant_id=123456789&region=dongjing&f=1&t=10'



返回参数

+-------------------+-------------+-------------------------------------------------------------------------+
|  字段名           |  类型       |  描述                                                                   |
+===================+=============+=========================================================================+
|  vm_servers       |  dict       |  包含了所有物理机列表，每个物理的详细信息                               |
+-------------------+-------------+-------------------------------------------------------------------------+
|  asset_id         |  string     |  物理机资产编号                                                         |
+-------------------+-------------+-------------------------------------------------------------------------+
|  available        |  int        |  ilo 是否可用                                                           |
+-------------------+-------------+-------------------------------------------------------------------------+
|  cpu_num          |  int        |  cpu 核数                                                               |
+-------------------+-------------+-------------------------------------------------------------------------+
|  create_at        |  string     |  创建时间                                                               |
+-------------------+-------------+-------------------------------------------------------------------------+
|  update_at        |  string     |  更新时间                                                               |
+-------------------+-------------+-------------------------------------------------------------------------+
|  deleted          |  int        |  是否删除                                                               |
+-------------------+-------------+-------------------------------------------------------------------------+
|  disk_size        |  int        |  磁盘大小                                                               |
+-------------------+-------------+-------------------------------------------------------------------------+
|  host_name        |  string     |  主机名                                                                 |
+-------------------+-------------+-------------------------------------------------------------------------+
|  ip               |  string     |  物理机ip，逗号分割                                                     |
+-------------------+-------------+-------------------------------------------------------------------------+
|  manufacturer     |  string     |  物理机厂商                                                             |
+-------------------+-------------+-------------------------------------------------------------------------+
|  mem_size         |  int        |  物理机内存                                                             |
+-------------------+-------------+-------------------------------------------------------------------------+
|  region           |  string     |  所属区域                                                               |
+-------------------+-------------+-------------------------------------------------------------------------+
|  status           |  string     |  物理机状态                                                             |
+-------------------+-------------+-------------------------------------------------------------------------+
|  system_snid      |  string     |  系统序列号                                                             |
+-------------------+-------------+-------------------------------------------------------------------------+
|  system_type      |  string     |  物理机操作系统                                                         |
+-------------------+-------------+-------------------------------------------------------------------------+
|  tenant_id        |  string     |  项目ID                                                                 |
+-------------------+-------------+-------------------------------------------------------------------------+
|  tenant_name      |  string     |  项目名称                                                               |
+-------------------+-------------+-------------------------------------------------------------------------+


返回样例

::


        HTTP/1.0 200 OK
        Content-Type: application/json
        Content-Length: 537
        Server: Werkzeug/0.10.4 Python/2.7.5
        Date: Thu, 28 Jan 2016 05:53:28 GMT

        {
          "vm_servers": [
            {
              "OS-DCF:diskConfig": "AUTO",
              "OS-EXT-AZ:availability_zone": "nova",
              "OS-EXT-SRV-ATTR:host": "SH-F1-Cloud23",
              "OS-EXT-SRV-ATTR:hypervisor_hostname": "SH-F1-Cloud23",
              "OS-EXT-SRV-ATTR:instance_name": "instance-000000b6",
              "OS-EXT-STS:power_state": 0,
              "OS-EXT-STS:task_state": null,
              "OS-EXT-STS:vm_state": "error",
              "OS-SRV-USG:launched_at": null,
              "OS-SRV-USG:terminated_at": null,
              "accessIPv4": "",
              "accessIPv6": "",
              "addresses": {},
              "config_drive": "",
              "created": "2016-02-19T07:49:06Z",
              "fault": {
                "code": 400,
                "created": "2016-02-19T07:52:41Z",
                "message": "Block Device Mapping is Invalid."
              },
              "flavor": {
                "id": "09a753f6-21c5-43b5-ba06-7c0b251aefb3",
                "links": [
                  {
                    "href": "http://192.168.39.171:8774/74d4bda6aa1c466d8cb1f2b8eac79567/flavors/09a753f6-21c5-43b5-ba06-7c0b251aefb3",
                    "rel": "bookmark"
                  }
                ]
              },
              "hostId": "5464aced14e9844a3c858b50b43f8be6231ad8349f6d06005523d739",
              "id": "c580a68a-b8c9-45ff-916b-65c153f9d9d2",
              "image": "",
              "key_name": null,
              "links": [
                {
                  "href": "http://192.168.39.171:8774/v2/74d4bda6aa1c466d8cb1f2b8eac79567/servers/c580a68a-b8c9-45ff-916b-65c153f9d9d2",
                  "rel": "self"
                },
                {
                  "href": "http://192.168.39.171:8774/74d4bda6aa1c466d8cb1f2b8eac79567/servers/c580a68a-b8c9-45ff-916b-65c153f9d9d2",
                  "rel": "bookmark"
                }
              ],
              "metadata": {},
              "name": "1111-c580a68a-b8c9-45ff-916b-65c153f9d9d2",
              "os-extended-volumes:volumes_attached": [],
              "status": "ERROR",
              "tenant_id": "74d4bda6aa1c466d8cb1f2b8eac79567",
              "updated": "2016-02-19T07:52:41Z",
              "user_id": "cc13d74dfbc14ca6909f050b5b589c83"
            }
          ]
        }


