


虚拟机电源接口
====================

.. toctree::
   :maxdepth: 2
   :numbered:



概要
--------------------

控制虚拟机的开关机及重启动作，需要带上有效的 Token。


API规范
--------------------------

控制虚拟机电源API入口与API列表如下：


    * API入口: http://tcapi.twocloud.cn
    * API列表:

+------------------+-------------------------------+------------+--------------------------------+
|  资源            |  操作                         |  HTTP方法  |  URI路径                       |
+==================+===============================+============+================================+
|  servers_act     |  对虚拟机电源操作             |  POST      |  /twocloud/servers_act         |
+------------------+-------------------------------+------------+--------------------------------+


先认证并获取新令牌(已可用), 使用该令牌执行获取动作
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

+------------+------------------------+-----------------+
|  HTTP方法  |  URI路径               |  描述           |
+============+========================+=================+
|  POST      |  /twocloud/servers_act |  虚拟机电源操作 |
+------------+------------------------+-----------------+

请求参数

+-----------------------+----------+--------------------------------------+
|  字段名               |  类型    |  描述                                |
+=======================+==========+======================================+
|  token                |  string  |  token                               |
+-----------------------+----------+--------------------------------------+
|  password             | string   |  任意字符串                          |
+-----------------------+----------+--------------------------------------+
|  act                  |  string  |  指定执行的动作 [on|off|reset]      |
+-----------------------+----------+--------------------------------------+
|  username             |  string  |  操作用户的用户名                    |
+-----------------------+----------+--------------------------------------+
|  region               |  string  |  所属区域                            |
+-----------------------+----------+--------------------------------------+
|  tenant_id            |  string  |  租户ID                              |
+-----------------------+----------+--------------------------------------+
|  server_ids           |  string  |  操作的虚拟机列表，逗号分割          |
+-----------------------+----------+--------------------------------------+
|  party                |  string  |  虚拟机所属第三方                    |
+-----------------------+----------+--------------------------------------+

请求样例

::


    curl  -i \
          -u {token}:password \
          -H 'Content-Type: application/json' \
          -X POST 'http://m.scloudm.com/twocloud/servers_act' \
          -d '{
            "act": "on|off|reset",
            "username": "liujiahua",
            "server_ids": "12323,12321321,42131",
            "tenant_id": "1234567890",
            "region": "gz",
            "party": "qcloud"
          }'



返回参数

+-------------------+-------------+-------------------------------------------------------------------------+
|  字段名           |  类型       |  描述                                                                   |
+===================+=============+=========================================================================+
|  msg              |  string     |  开关机或重启成功                                                       |
+-------------------+-------------+-------------------------------------------------------------------------+
|  code             |  int        |  返回码, 非200即为失败                                                  |
+-------------------+-------------+-------------------------------------------------------------------------+
|  detail           |   list      |  每台机器的结果                                                         |
+-------------------+-------------+-------------------------------------------------------------------------+


返回样例

::


        HTTP/1.0 200 OK
        Content-Type: application/json
        Content-Length: 537
        Server: Werkzeug/0.10.4 Python/2.7.5
        Date: Thu, 28 Jan 2016 05:53:28 GMT

        {
          "code": 400,
          "msg": "failed"
          "detail": [
            {
              "code": 400,
              "msg": "failed",
              "instance_id": "2423dfs234"
            },
            {
              "code": 400,
              "msg": "failed",
              "instance_id": "242324dfs234"
            },
            {
              "code": 400,
              "msg": "failed",
              "instance_id": "24232dfs2349"
            }
          ]
        }

